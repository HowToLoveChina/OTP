#define _SM3FUNC_C_	
#include "SM3FUNC.H"
/********************************************************************
Function name:       void vSm3Hash(void)
Input parameters:
    void
Return:
    void
Function:
    执行SM3硬件算法，此函数为OTP专用，用户需要将参数与结果0x0380以上的算法区域 
函数内部不对参数进行判断，因此只支持小于64byte的数据包的HASH运算
#define ARAM_BASE       (0x0B80)
#define SM3_A_BASE 		(&XBYTE[ARAM_BASE])
#define SM3_MSG_BASE 	(&XBYTE[ARAM_BASE + 32])
#define SM3_T_BASE 		(&XBYTE[ARAM_BASE + 96])
#define SM3_VA_BASE 	SM3_MSG_BASE 
********************************************************************/

void vSm3Hash(void)
{ 	
	SCUMCG |= (1 << 4);
    //IV 	
	//memcpy(SM3_A_BASE, vSM3_IV, 32);
	XBYTE[0x0B80]=0x73;
	XBYTE[0x0B81]=0x80;
	XBYTE[0x0B82]=0x16;
	XBYTE[0x0B83]=0x6f;
	XBYTE[0x0B84]=0x49;
	XBYTE[0x0B85]=0x14;
	XBYTE[0x0B86]=0xb2;
	XBYTE[0x0B87]=0xb9;

	XBYTE[0x0B88]=0x17;
	XBYTE[0x0B89]=0x24;
	XBYTE[0x0B8a]=0x42;
	XBYTE[0x0B8b]=0xd7;
	XBYTE[0x0B8c]=0xda;
	XBYTE[0x0B8d]=0x8a;
	XBYTE[0x0B8e]=0x06;
	XBYTE[0x0B8f]=0x00;

	XBYTE[0x0B90]=0xa9;
	XBYTE[0x0B91]=0x6f;
	XBYTE[0x0B92]=0x30;
	XBYTE[0x0B93]=0xbc;
	XBYTE[0x0B94]=0x16;
	XBYTE[0x0B95]=0x31;
	XBYTE[0x0B96]=0x38;
	XBYTE[0x0B97]=0xaa;

	XBYTE[0x0B98]=0xe3;
	XBYTE[0x0B99]=0x8d;
	XBYTE[0x0B9a]=0xee;
	XBYTE[0x0B9b]=0x4d;
	XBYTE[0x0B9c]=0xb0;
	XBYTE[0x0B9d]=0xfb;
	XBYTE[0x0B9e]=0x0e;
	XBYTE[0x0B9f]=0x4e;
    //T1&&T2 	
	//memcpy(SM3_T_BASE, vSM3_T, 8);
	XBYTE[0x0BE0]=0x79;
	XBYTE[0x0BE1]=0xCC;
	XBYTE[0x0BE2]=0x45;
	XBYTE[0x0BE3]=0x19;
	XBYTE[0x0BE4]=0x7A;
	XBYTE[0x0BE5]=0x87;
	XBYTE[0x0BE6]=0x9D;
	XBYTE[0x0BE7]=0x8A;
    //message
	//memcpy(SM3_MSG_BASE, MessBlock, 64);

	SM3INT |= 0x01;
	SM3CON = (SM3CON & 0xFC) | 0x01;
	_nop_();
	_nop_();
	_nop_();     
	//while(SM3CON & 0x01);
	//memcpy(SM3_VA_BASE, vSM3_IV, 32);
	XBYTE[0x0BA0]=0x73;
	XBYTE[0x0BA1]=0x80;
	XBYTE[0x0BA2]=0x16;
	XBYTE[0x0BA3]=0x6f;
	XBYTE[0x0BA4]=0x49;
	XBYTE[0x0BA5]=0x14;
	XBYTE[0x0BA6]=0xb2;
	XBYTE[0x0BA7]=0xb9;

	XBYTE[0x0BA8]=0x17;
	XBYTE[0x0BA9]=0x24;
	XBYTE[0x0BAa]=0x42;
	XBYTE[0x0BAb]=0xd7;
	XBYTE[0x0BAc]=0xda;
	XBYTE[0x0BAd]=0x8a;
	XBYTE[0x0BAe]=0x06;
	XBYTE[0x0BAf]=0x00;

	XBYTE[0x0BB0]=0xa9;
	XBYTE[0x0BB1]=0x6f;
	XBYTE[0x0BB2]=0x30;
	XBYTE[0x0BB3]=0xbc;
	XBYTE[0x0BB4]=0x16;
	XBYTE[0x0BB5]=0x31;
	XBYTE[0x0BB6]=0x38;
	XBYTE[0x0BB7]=0xaa;

	XBYTE[0x0BB8]=0xe3;
	XBYTE[0x0BB9]=0x8d;
	XBYTE[0x0BBa]=0xee;
	XBYTE[0x0BBb]=0x4d;
	XBYTE[0x0BBc]=0xb0;
	XBYTE[0x0BBd]=0xfb;
	XBYTE[0x0BBe]=0x0e;
	XBYTE[0x0BBf]=0x4e;

	SM3INT |= 0x01;
	SM3CON = (SM3CON & 0xFC) | 0x03; //SM3算法运行期间，CPU HOLD，SM3运行完成后，才能向下执行
	_nop_();
	_nop_();
	_nop_();    
	//while(SM3CON & 0x01);
	//memcpy(Digest, SM3_A_BASE, 32);	
}
