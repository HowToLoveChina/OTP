C51 COMPILER V9.00   EWATCHAPP                                                             03/23/2015 15:38:06 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE EWATCHAPP
OBJECT MODULE PLACED IN .\ObjFile\EwatchApp.obj
COMPILER INVOKED BY: H:\Keil\C51\BIN\C51.EXE SrcFile\App\EwatchApp.c LARGE BROWSE INCDIR(.\SrcFile\StartUp\CPU;.\SrcFile
                    -\Frame\Inc;.\SrcFile\Func\Inc;.\SrcFile\Lib;.\SrcFile\App\Inc) DEFINE(_DEV_BOARD_) DEBUG OBJECTEXTEND PRINT(.\LstFile\Ew
                    -atchApp.lst) OBJECT(.\ObjFile\EwatchApp.obj)

line level    source

   1          #define _EWATCHAPP_C_   
   2          #include "EWATCHAPP.H" 
   3          #include "String.H"
   4          #include "TokenApp.H" 
   5          
   6          #include "Debug.H"
*** WARNING C318 IN LINE 3 OF .\SRCFILE\FRAME\INC\OTPFRAME.H: can't open file 'REG_Z8D16R.h'
*** ERROR C231 IN LINE 42 OF .\SRCFILE\FRAME\INC\OTPFRAME.H: 'gUnlockPinErr_Count': redefinition
*** ERROR C231 IN LINE 49 OF .\SRCFILE\FRAME\INC\OTPFRAME.H: 'gPin_Save': redefinition
*** WARNING C318 IN LINE 3 OF .\SRCFILE\FRAME\INC\OTPFRAME.H: can't open file 'REG_Z8D16R.h'
*** ERROR C231 IN LINE 42 OF .\SRCFILE\FRAME\INC\OTPFRAME.H: 'gUnlockPinErr_Count': redefinition
   7          
   8          /********************************************************************
   9          Function name:       void vOTP_Ewatch(void)
  10          Input parameters:
  11              void  
  12          Return:
  13              void
  14          Function:
  15              OTP e-Watch         
  16          ********************************************************************/
  17          UINT8 volatile CurTimeBuf[9]={"00-00-00"};
  18          UINT8 volatile SetTimeBuf[10]={"0000000000"};
  19          //UINT32 gTbcBackUpTime;
  20          
  21          #define hTime     ((((gTimer_Count_Base+TBC_COUNT_VALUE)-gBackupInitVal)/3600)%24)
  22          #define mTime     ((((gTimer_Count_Base+TBC_COUNT_VALUE)-gBackupInitVal)/60)%60)
  23          #define sTime     (((gTimer_Count_Base+TBC_COUNT_VALUE)-gBackupInitVal)%60)
  24          
  25          void vTimer_Disp(void)
  26          {
  27   1              //UINT8 TmpVal[6]; 
  28   1              vScu_TbcClkEn();
  29   1              //采用备份计数器计时
  30   1              vTbc_ReadBakCounter();
  31   1              //sprintf(TmpVal,"%02lu",hTime);        
  32   1              //CurTimeBuf[0]=TmpVal[0];
  33   1              //CurTimeBuf[1]=TmpVal[1];
  34   1              sprintf(CurTimeBuf,"%02lu",hTime);
  35   1      
  36   1              //sprintf(TmpVal,"%02lu",mTime);        
  37   1              //CurTimeBuf[3]=TmpVal[0];
  38   1              //CurTimeBuf[4]=TmpVal[1];
  39   1              sprintf(&CurTimeBuf[3],"%02lu",(mTime));
  40   1              
  41   1              //sprintf(TmpVal,"%02lu",sTime);        
  42   1              //CurTimeBuf[6]=TmpVal[0];
  43   1              //CurTimeBuf[7]=TmpVal[1];
  44   1              sprintf(&CurTimeBuf[6],"%02lu",sTime);
  45   1              
  46   1              CurTimeBuf[2]='-';
  47   1              CurTimeBuf[5]='-';
  48   1      
C51 COMPILER V9.00   EWATCHAPP                                                             03/23/2015 15:38:06 PAGE 2   

  49   1      #ifdef _FPGA_DEMO_EN_
                      vLcd_SetStopMode();                                                 
              #endif                                  
  52   1          //vLcd_String_Clear();
  53   1              
  54   1              vLcd_String_Display(CurTimeBuf,9);
  55   1      
  56   1      #ifdef _FPGA_DEMO_EN_  
                      vLcd_SetDisplayMode();          
              #endif          
  59   1      
  60   1      } 
  61          
  62          void vUtc_To_GTM8(void)
  63          {
  64   1               gUseCase = 1;                  //系统提示为输入PIN
  65   1               vScu_TbcClkEn();
  66   1               vScu_TbcIntEn();
  67   1               vTbc_Int1HzEn();
  68   1               ET0=1;
  69   1               EA=1;
  70   1               vLcd_Clear_All();
  71   1               while(1)
  72   1               {
  73   2                       if(gFlag_1S==0x5a)
  74   2                       {
  75   3                               gFlag_1S=0x00;
  76   3                               vTimer_Disp();
  77   3                       }
  78   2               }
  79   1      }
  80          
  81          void vOTP_Ewatch(void)
  82          {
  83   1      
  84   1          UINT8 Key_Input=15,j,i=0,bWatch = 1;
  85   1              //TBC开启
  86   1              //vTbcInit();
  87   1      
  88   1      
  89   1              gUseCase = 1;                   //系统提示为输入PIN
  90   1              i = 8;
  91   1              
  92   1              gCursor_Flag = 0;
  93   1              gPinErr_Count = 0; 
  94   1              vScu_TbcIntDis();       
  95   1      #ifdef _FPGA_DEMO_EN_
                      vLcd_SetStopMode();                                         
              #endif
  98   1          vLcd_Clear_All();
  99   1              vLcd_String_Display(CurTimeBuf,8);
 100   1      #ifdef _FPGA_DEMO_EN_  
                      vLcd_SetDisplayMode();          
              #endif
 103   1          //10s重新定时开始
 104   1              
 105   1              gSecCount_10S=0;
 106   1              gFlag_1S=0x00;
 107   1              while(bWatch==1)
 108   1              {
 109   2                      Key_Input = ucGetKeyValue();    
 110   2                      if(Key_Input>=0x30 && Key_Input<=0x3f)
C51 COMPILER V9.00   EWATCHAPP                                                             03/23/2015 15:38:06 PAGE 3   

 111   2                      {                       //如果是正常的数据，存入接受数组
 112   3                              //如果移动了光标位置，则修改光标位置的数据
 113   3                              switch(Key_Input)
 114   3                              {
 115   4                                      case '0':
 116   4                                      case '1':
 117   4                                      case '2':
 118   4                                      case '3':
 119   4                                      case '4':
 120   4                                      case '5':
 121   4                                      case '6':
 122   4                                      case '7':
 123   4                                      case '8':
 124   4                                      case '9':
 125   4                                           if(gCursor_Flag )          //有光标移到，则修改光标移动位置的数据
 126   4                                           {
 127   5                                                   gCursor_Flag = 0;
 128   5                                                   CurTimeBuf[i-gCursor_Count] = Key_Input;
 129   5      #ifdef _FPGA_DEMO_EN_
                                           vLcd_SetStopMode();                                                    
              #endif
 132   5                               vLcd_Clear_All();
 133   5                                                   vLcd_String_Display(CurTimeBuf,i);
 134   5      #ifdef _FPGA_DEMO_EN_  
                                           vLcd_SetDisplayMode();             
              #endif
 137   5                                                   gCursor_Count = 0;
 138   5                                                       i=8;
 139   5                                                              
 140   5                                           }
 141   4                                           else
 142   4                                           {
 143   5                                                   if(i<8)
 144   5                                                   {
 145   6                                                           
 146   6      
 147   6                                                           CurTimeBuf[i] = Key_Input;
 148   6                                                           i++;
 149   6      #ifdef _FPGA_DEMO_EN_
                                               vLcd_SetStopMode();                                                             
              #endif
 152   6                                   vLcd_Clear_All();
 153   6                                                           vLcd_String_Display(CurTimeBuf,i);
 154   6      #ifdef _FPGA_DEMO_EN_  
                                               vLcd_SetDisplayMode();         
              #endif                                          
 157   6                                   
 158   6                                                   }                                          
 159   5                                           }                                  
 160   4                                           break;
 161   4                                      case 0x3a:                                           
 162   4                                               //i = 0;
 163   4                                               for(j=0;j<8;j++)
 164   4                                               {
 165   5      #ifdef _FPGA_DEMO_EN_
                                           vLcd_SetStopMode();
                                                                  
              #endif
 169   5                               vLcd_Clear_All();
 170   5                                                       vLcd_Bcd_Clear(j);
 171   5      #ifdef _FPGA_DEMO_EN_  
                                           vLcd_SetDisplayMode();             
C51 COMPILER V9.00   EWATCHAPP                                                             03/23/2015 15:38:06 PAGE 4   

              #endif
 174   5                                               }
 175   4                                               break;
 176   4                                      case 0x3c:                      //左移动光标                            
 177   4                                               if(i>0)
 178   4                                               {
 179   5                                                       gCursor_Flag = 1;
 180   5                                                       if(gCursor_Count < i)
 181   5                                                       {
 182   6                                                               gCursor_Count++;
 183   6                                                       }
 184   5                                                       else
 185   5                                                       {
 186   6                                                               gCursor_Count = 1;
 187   6                                                       }
 188   5      #ifdef _FPGA_DEMO_EN_
                                           vLcd_SetStopMode();                                                     
              #endif
 191   5                               vLcd_Clear_All();
 192   5                                                       vLcd_String_Display(CurTimeBuf,i);
 193   5                                                       vLcd_Bcd_Clear(gCursor_Count-1);
 194   5      #ifdef _FPGA_DEMO_EN_  
                                           vLcd_SetDisplayMode();             
              #endif                                           
 197   5                                               }
 198   4                                               break;
 199   4                                      case 0x3d:                      //右移动光标
 200   4                                               if(i>0)
 201   4                                               {
 202   5                                                       gCursor_Flag = 1;
 203   5                                                       if(gCursor_Count > 1)
 204   5                                                       {
 205   6                                                               gCursor_Count--;
 206   6                                                       }
 207   5                                                       else
 208   5                                                       {
 209   6                                                               gCursor_Count = i;
 210   6                                                       }
 211   5      #ifdef _FPGA_DEMO_EN_
                                           vLcd_SetStopMode();
                                                                  
              #endif
 215   5                               vLcd_Clear_All();
 216   5                                                       vLcd_String_Display(CurTimeBuf,i);
 217   5                                                       vLcd_Bcd_Clear(gCursor_Count-1);
 218   5      #ifdef _FPGA_DEMO_EN_  
                                           vLcd_SetDisplayMode();             
              #endif                                           
 221   5                                               }
 222   4                                               break;
 223   4                                      case 0x3E:
 224   4                                               vScu_TbcIntDis();//暂停，开始调整校准时间
 225   4                                               
 226   4      
 227   4                                               i = 8;
 228   4                                               gCursor_Flag = 0;
 229   4                                               break;
 230   4                                      case 0x3b:                      //确认
 231   4                                          //vTbcInit();
 232   4                                                                      
 233   4                                               vScu_TbcIntEn();//设置完成时间初始值，开始启动TBC
 234   4                                                                                                                                              
C51 COMPILER V9.00   EWATCHAPP                                                             03/23/2015 15:38:06 PAGE 5   

 235   4                                               i = 8;
 236   4                                               gCursor_Flag = 0; 
 237   4                                               
 238   4                                               
 239   4                                               break;
 240   4                                      case 0x3f:
 241   4                                           gUseCase=3;
 242   4                                               bWatch=0;
 243   4                                               vTimer_Counter_Disp(TBC_COUNT_VALUE);
 244   4                                           break;
 245   4                                }
 246   3                                                      
 247   3                       }
 248   2                       else
 249   2                       {
 250   3                              if(gFlag_1S==0x5a)
 251   3                                      {
 252   4                                          gFlag_1S=0x00;
 253   4                                      CurTimeBuf[7]+=1;
 254   4                                                                              
 255   4                                              if(0x3a==CurTimeBuf[7]) //秒
 256   4                                              {
 257   5                                                  CurTimeBuf[7]=0x30;
 258   5                                                      CurTimeBuf[6]+=1;
 259   5                                              }
 260   4                                              if(0x36==CurTimeBuf[6])
 261   4                                              {
 262   5                                                      CurTimeBuf[6]=0x30;
 263   5                                                      CurTimeBuf[4]+=1;
 264   5                                              }
 265   4                                              if(0x3a==CurTimeBuf[4])//分
 266   4                                              {
 267   5                                                      CurTimeBuf[4]=0x30;
 268   5                                                      CurTimeBuf[3]+=1;
 269   5      
 270   5                                                      //vFreqAdj();
 271   5                                              }
 272   4                                              if(0x36==CurTimeBuf[3])
 273   4                                              {
 274   5                                                      CurTimeBuf[3]=0x30;
 275   5                                                      CurTimeBuf[1]+=1;
 276   5                                                      //频率补偿
 277   5                                                      //EA=0;
 278   5                                  //vFreqAdj();
 279   5                                                      //EA=1;
 280   5                                                      
 281   5                                              }
 282   4                                              if(CurTimeBuf[0]<0x32) //小时
 283   4                                              {
 284   5                                                      if(0x3a==CurTimeBuf[1])
 285   5                                                      {
 286   6                                                               CurTimeBuf[1]=0x30;
 287   6                                                               CurTimeBuf[0]+=1;                                                       
 288   6                                                      }
 289   5                                              }
 290   4                                              else
 291   4                                              {
 292   5                                                      if(0x34==CurTimeBuf[1])
 293   5                                                      {
 294   6                                                          CurTimeBuf[1]=0x30;
 295   6                                                              CurTimeBuf[0]=0x30;
 296   6                                                      }
C51 COMPILER V9.00   EWATCHAPP                                                             03/23/2015 15:38:06 PAGE 6   

 297   5                                              }
 298   4              #ifdef _FPGA_DEMO_EN_
                                           vLcd_SetStopMode();                                                         
                      #endif
 301   4                               //vLcd_Clear_All();
 302   4                                               vLcd_String_Display(CurTimeBuf,8);
 303   4              #ifdef _FPGA_DEMO_EN_  
                                           vLcd_SetDisplayMode();             
                      #endif                                          
 306   4                                 }
 307   3                       }
 308   2              }
 309   1              vScu_TbcIntDis();         
 310   1      } 
 311          
 312          /*void vOTP_Ewatch(void)
 313          {
 314                  
 315              UINT8 Key_Input=15,j,i=0,bWatch = 1;
 316                  //TBC开启
 317                  vTbcInit();
 318          
 319          
 320                  gUseCase = 1;                   //系统提示为设置PIN
 321                  i = 10;
 322                  
 323                  gCursor_Flag = 0;
 324                  gPinErr_Count = 0; 
 325                  vScu_TbcIntDis();       
 326          #ifdef _FPGA_DEMO_EN_
 327                  vLcd_SetStopMode();                                         
 328          #endif
 329              vLcd_Clear_All();
 330                  vLcd_String_Display(SetTimeBuf,10);
 331          #ifdef _FPGA_DEMO_EN_  
 332                  vLcd_SetDisplayMode();          
 333          #endif
 334              //10s重新定时开始
 335                  
 336                  gSecCount_10S=0;
 337                  gFlag_1S=0x00;
 338                  while(bWatch==1)
 339                  {
 340                          Key_Input = ucGetKeyValue();    
 341                          if(Key_Input>=0x30 && Key_Input<=0x3f)
 342                          {                       //如果是正常的数据，存入接受数组
 343                                  //如果移动了光标位置，则修改光标位置的数据
 344                                  switch(Key_Input)
 345                                  {
 346                                          case '0':
 347                                          case '1':
 348                                          case '2':
 349                                          case '3':
 350                                          case '4':
 351                                          case '5':
 352                                          case '6':
 353                                          case '7':
 354                                          case '8':
 355                                          case '9':
 356                                               if(gCursor_Flag )          //有光标移到，则修改光标移动位置的数据
 357                                               {
 358                                                       gCursor_Flag = 0;
C51 COMPILER V9.00   EWATCHAPP                                                             03/23/2015 15:38:06 PAGE 7   

 359                                                       SetTimeBuf[i-gCursor_Count] = Key_Input;
 360          #ifdef _FPGA_DEMO_EN_
 361                                       vLcd_SetStopMode();                                                    
 362          #endif
 363                                   vLcd_Clear_All();
 364                                                       vLcd_String_Display(SetTimeBuf,i);
 365          #ifdef _FPGA_DEMO_EN_  
 366                                       vLcd_SetDisplayMode();             
 367          #endif
 368                                                       gCursor_Count = 0;
 369                                                           i=10;
 370                                                                  
 371                                               }
 372                                               else
 373                                               {
 374                                                       if(i<10)
 375                                                       {
 376                                                               
 377          
 378                                                               SetTimeBuf[i] = Key_Input;
 379                                                               i++;
 380          #ifdef _FPGA_DEMO_EN_
 381                                           vLcd_SetStopMode();                                                             
 382          #endif
 383                                       vLcd_Clear_All();
 384                                                               vLcd_String_Display(SetTimeBuf,i);
 385          #ifdef _FPGA_DEMO_EN_  
 386                                           vLcd_SetDisplayMode();         
 387          #endif                                          
 388                                       
 389                                                       }                                          
 390                                               }                                  
 391                                               break;
 392                                          case 0x3a:                                           
 393                                                   //i = 0;
 394                                                   for(j=0;j<10;j++)
 395                                                   {
 396          #ifdef _FPGA_DEMO_EN_
 397                                       vLcd_SetStopMode();
 398                                                              
 399          #endif
 400                                   vLcd_Clear_All();
 401                                                           vLcd_Bcd_Clear(j);
 402          #ifdef _FPGA_DEMO_EN_  
 403                                       vLcd_SetDisplayMode();             
 404          #endif
 405                                                   }
 406                                                   break;
 407                                          case 0x3c:                      //左移动光标                            
 408                                                   if(i>0)
 409                                                   {
 410                                                           gCursor_Flag = 1;
 411                                                           if(gCursor_Count < i)
 412                                                           {
 413                                                                   gCursor_Count++;
 414                                                           }
 415                                                           else
 416                                                           {
 417                                                                   gCursor_Count = 1;
 418                                                           }
 419          #ifdef _FPGA_DEMO_EN_
 420                                       vLcd_SetStopMode();                                                     
C51 COMPILER V9.00   EWATCHAPP                                                             03/23/2015 15:38:06 PAGE 8   

 421          #endif
 422                                   vLcd_Clear_All();
 423                                                           vLcd_String_Display(SetTimeBuf,i);
 424                                                           vLcd_Bcd_Clear(gCursor_Count-1);
 425          #ifdef _FPGA_DEMO_EN_  
 426                                       vLcd_SetDisplayMode();             
 427          #endif                                           
 428                                                   }
 429                                                   break;
 430                                          case 0x3d:                      //右移动光标
 431                                                   if(i>0)
 432                                                   {
 433                                                           gCursor_Flag = 1;
 434                                                           if(gCursor_Count > 1)
 435                                                           {
 436                                                                   gCursor_Count--;
 437                                                           }
 438                                                           else
 439                                                           {
 440                                                                   gCursor_Count = i;
 441                                                           }
 442          #ifdef _FPGA_DEMO_EN_
 443                                       vLcd_SetStopMode();
 444                                                              
 445          #endif
 446                                   vLcd_Clear_All();
 447                                                           vLcd_String_Display(SetTimeBuf,i);
 448                                                           vLcd_Bcd_Clear(gCursor_Count-1);
 449          #ifdef _FPGA_DEMO_EN_  
 450                                       vLcd_SetDisplayMode();             
 451          #endif                                           
 452                                                   }
 453                                                   break;
 454                                          case 0x3E:
 455                                                   vScu_TbcIntDis();//暂停，开始调整校准时间
 456                                                   
 457          
 458                                                   i = 10;
 459                                                   gCursor_Flag = 0;
 460                                                   break;
 461                                          case 0x3b:                      //确认
 462                                               
 463                                                   gTimer_Count_Base=((UINT32)(SetTimeBuf[0]-0x30))*10*10*10*10*10*10*10*10*10+((UINT32)(SetTimeBuf[1]-
             -0x30))*10*10*10*10*10*10*10*10+((UINT32)(SetTimeBuf[2]-0x30))*10*10*10*10*10*10*10+
 464                                                                     ((UINT32)(SetTimeBuf[3]-0x30))*10*10*10*10*10*10+((UINT32)(SetTimeBuf[4]-0x30))*10
             -*10*10*10*10+((UINT32)(SetTimeBuf[5]-0x30))*10*10*10*10+
 465                                                                                     ((UINT32)(SetTimeBuf[6]-0x30))*10*10*10+((UINT32)(SetTimeBuf[7]-0x30))*10*10+((UINT32)(SetTime
             -Buf[8]-0x30))*10+((UINT32)(SetTimeBuf[9]-0x30));
 466          
 467                                                   //sprintf(gTimer_Count_Base,"%lx",SetTimeBuf);
 468                                                   //memcpy(&gTimer_Count_Base,SetTimeBuf,10);
 469                                                   //sprintf(&gTimer_Count_Base,"%lx",(UINT32)SetTimeBuf);
 470          
 471          
 472                                               vTbcInit();
 473                                                   //vTimer_Counter_Disp(TBC_COUNT_VALUE);                        
 474                                                   vScu_TbcIntEn();//设置完成时间初始值，开始启动TBC
 475                                                                                                                                                  
 476                                                   i = 10;
 477                                                   gCursor_Flag = 0; 
 478                                                   
 479                                                   vLcd_Clear_All();
C51 COMPILER V9.00   EWATCHAPP                                                             03/23/2015 15:38:06 PAGE 9   

 480                                                   break;
 481                                          case 0x3f:
 482                                               gUseCase=3;
 483                                                   bWatch=0;
 484                                                   vTimer_Counter_Disp(TBC_COUNT_VALUE);
 485                                               break;
 486                                    }
 487                                                          
 488                           }
 489                           else
 490                           {
 491                                  if(gFlag_1S==0x5a)
 492                                          {
 493                                              gFlag_1S=0x00;
 494                                          vTimer_Disp();                          
 495                                     }
 496                           }
 497                  }
 498                  vScu_TbcIntDis();       
 499          
 500          }*/
 501          
 502          
 503          
 504          
 505          
 506          
 507          
 508          #endif

C51 COMPILATION COMPLETE.  2 WARNING(S),  3 ERROR(S)
