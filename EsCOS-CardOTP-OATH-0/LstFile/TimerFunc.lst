C51 COMPILER V9.01   TIMERFUNC                                                             11/23/2016 11:58:14 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE TIMERFUNC
OBJECT MODULE PLACED IN .\ObjFile\TimerFunc.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE SrcFile\Func\TimerFunc.c LARGE BROWSE INCDIR(.\SrcFile\StartUp\CPU;.\SrcFil
                    -e\Frame\Inc;.\SrcFile\Func\Inc;.\SrcFile\Lib;.\SrcFile\App\Inc) DEFINE(_DEV_BOARD_,_FPGA_DEMO_EN_) DEBUG OBJECTEXTEND PR
                    -INT(.\LstFile\TimerFunc.lst) OBJECT(.\ObjFile\TimerFunc.obj)

line level    source

   1          /********************************************************************
   2                                    Nationz Co.,Ltd
   3                  Copyright (c) 2009－2015 All Rights Reserved
   4           ********************************************************************
   5          File: TimerFunc.c
   6          History：
   7          Version                      Author                     Date
   8          V0.1                         nationz              2013-03-27
   9          
  10          Description:
  11               TimerFunc Source Code File;
  12          Function list:
  13               void vTimerStart(UINT8 TimerNum,UINT8 Mode,UINT16 InitValue)；        
  14          Special statement:
  15               NULL
  16           *******************************************************************/
  17          #define _TIMERFUNC_C_
  18          #include "TIMERFUNC.H"
  19          #include "SCUFUNC.H"
  20          #include "Debug.H"
  21          /********************************************************************
  22          Function name:       vTimer1Start
  23          Input parameters:
  24              UINT8 TimerNum：Timer Select 
  25                  UINT8 Mode：Timer Mode Config
  26                  UINT16 InitValue：      Timer Initial 
  27          Return:
  28              void
  29          Function:
  30              Enable Timer Module.
  31          ********************************************************************/
  32          #if 1
  33          void vTimerClkSel(UINT8 TimerNum,UINT8 TimerClk)
  34          {
  35   1               switch(TimerClk)
  36   1               {
  37   2                        case TM1_32KEN:
  38   2                        case TM2_32KEN:                      
  39   2                        case TM1_64KEN:
  40   2                        case TM2_64KEN:
  41   2                                 SCUOSCCTRL|=0x20;
  42   2                                 break;
  43   2                        case TM1_500KEN:
  44   2                        case TM2_500KEN:                     
  45   2                        case TM1_2MEN:
  46   2                        case TM2_2MEN:                       
  47   2                                 SCUOSCCTRL|=0x01;
  48   2                                 break;
  49   2                         default:
  50   2                             break;                  
  51   2                                 
  52   2               }
  53   1               if(TIMER0==TimerNum||TIMER1==TimerNum)
C51 COMPILER V9.01   TIMERFUNC                                                             11/23/2016 11:58:14 PAGE 2   

  54   1               {
  55   2                       SCUTMRCG &= 0xf0;
  56   2                       SCUTMRCG |= TimerClk; 
  57   2               }
  58   1               else if(TIMER2==TimerNum||TIMER3==TimerNum)
  59   1               {
  60   2                       SCUTMRCG &= 0x0f;
  61   2                   SCUTMRCG |= TimerClk;
  62   2               }
  63   1               
  64   1      }
  65          #endif
  66          
  67          void vTimer1Start(UINT8 TimerNum,UINT8 Mode,UINT16 InitValue,UINT8 TimerClk)
  68          {
  69   1           vScu_Timer1ClkEn();
  70   1               vTimerClkSel(TimerNum,TimerClk);        
  71   1               switch(Mode)
  72   1               {
  73   2                    
  74   2                        case TIMER_MODE0:     //两个8Bit的Timer
  75   2                             TM1MOD=0x00;
  76   2                                 if(TIMER0==TimerNum)
  77   2                                 {                          
  78   3                                         TM0CDATA=(UINT8)InitValue;
  79   3                                         //计数器清0
  80   3                                         vTimer0_CounterClr();
  81   3                                         vTimer0_Start();
  82   3                                         vScu_Timer0IntEn();
  83   3      
  84   3                                         vScu_Timer0WakeupEn();
  85   3                                 }
  86   2                                 else if(TIMER1==TimerNum)
  87   2                                 {                           
  88   3                                         TM1CDATA=(UINT8)InitValue;
  89   3                                         //计数器清0
  90   3                                         vTimer1_CounterClr();
  91   3                                         vTimer1_Start();
  92   3                                         vScu_Timer1IntEn();
  93   3      
  94   3                                         vScu_Timer1WakeupEn();
  95   3                                 }
  96   2                                 break;
  97   2                        case TIMER_MODE1://一个自动Load的8Bit的Timer
  98   2                             TM1MOD=0x01;
  99   2                                 if(TIMER0==TimerNum)
 100   2                                 {
 101   3                                         TM0CDATA=(UINT8)InitValue;
 102   3                                         //计数器清0
 103   3                                         vTimer0_CounterClr();
 104   3                                         vTimer0_Start();
 105   3                                         vScu_Timer0IntEn();
 106   3      
 107   3                                         vScu_Timer0WakeupEn();
 108   3                                 }
 109   2                                 else if(TIMER1==TimerNum)
 110   2                                 {
 111   3                                         TM1CDATA=(UINT8)InitValue;
 112   3                                         //计数器清0
 113   3                                         //vTimer0_CounterClr();
 114   3                                         vTimer1_CounterClr();
 115   3                                         
C51 COMPILER V9.01   TIMERFUNC                                                             11/23/2016 11:58:14 PAGE 3   

 116   3                                         vTimer1_Start();
 117   3                                         vScu_Timer1IntEn();
 118   3              
 119   3                                         vScu_Timer1WakeupEn();
 120   3                                 }                       
 121   2                                 
 122   2                                 break;
 123   2                        case TIMER_MODE2://一个16Bit的Timer
 124   2                             TM1MOD=0x02;     
 125   2      
 126   2                             TM0CDATA=(UINT8)InitValue;
 127   2                                 TM1CDATA=(UINT8)(InitValue>>8);
 128   2                                 //计数器清0
 129   2                                 vTimer0_CounterClr();
 130   2                                 vTimer1_CounterClr();
 131   2      
 132   2                                 vTimer0_Start();
 133   2                                 //vScu_Timer0IntEn();
 134   2                                 vScu_Timer1IntEn();
 135   2      
 136   2                                 vScu_Timer1WakeupEn();
 137   2                                 break;
 138   2                        default :
 139   2                             break;
 140   2               }
 141   1               EX1=1;  
 142   1               EA=1;   
 143   1      }
 144          
 145          
 146          void vTimerClkSel1(UINT8 TimerNum,UINT8 TimerClk)
 147          {
 148   1               switch(TimerClk)
 149   1               {
 150   2                        case TM1_32KEN:
 151   2                        case TM2_32KEN:                      
 152   2                        case TM1_64KEN:
 153   2                        case TM2_64KEN:
 154   2                                 SCUOSCCTRL|=0x20;
 155   2                                 break;
 156   2                        case TM1_500KEN:
 157   2                        case TM2_500KEN:                     
 158   2                        case TM1_2MEN:
 159   2                        case TM2_2MEN:                       
 160   2                                 SCUOSCCTRL|=0x01;
 161   2                                 break;
 162   2                         default:
 163   2                             break;                  
 164   2                                 
 165   2               }
 166   1               if(TIMER0==TimerNum||TIMER1==TimerNum)
 167   1               {
 168   2                       SCUTMRCG &= 0xf0;
 169   2                       SCUTMRCG |= TimerClk; 
 170   2               }
 171   1               else if(TIMER2==TimerNum||TIMER3==TimerNum)
 172   1               {
 173   2                       SCUTMRCG &= 0x0f;
 174   2                   SCUTMRCG |= TimerClk;
 175   2               }
 176   1               
 177   1      }
C51 COMPILER V9.01   TIMERFUNC                                                             11/23/2016 11:58:14 PAGE 4   

 178          
 179          
 180          void vTimer1Start1(UINT8 TimerNum,UINT8 Mode,UINT16 InitValue,UINT8 TimerClk)
 181          {
 182   1           vScu_Timer1ClkEn();
 183   1               vTimerClkSel1(TimerNum,TimerClk);       
 184   1               switch(Mode)
 185   1               {
 186   2                    
 187   2                        case TIMER_MODE0:     //两个8Bit的Timer
 188   2                             TM1MOD=0x00;
 189   2                                 if(TIMER0==TimerNum)
 190   2                                 {                          
 191   3                                         TM0CDATA=(UINT8)InitValue;
 192   3                                         //计数器清0
 193   3                                         vTimer0_CounterClr();
 194   3                                         vTimer0_Start();
 195   3                                         vScu_Timer0IntEn();
 196   3      
 197   3                                         vScu_Timer0WakeupEn();
 198   3                                 }
 199   2                                 else if(TIMER1==TimerNum)
 200   2                                 {                           
 201   3                                         TM1CDATA=(UINT8)InitValue;
 202   3                                         //计数器清0
 203   3                                         vTimer1_CounterClr();
 204   3                                         vTimer1_Start();
 205   3                                         vScu_Timer1IntEn();
 206   3      
 207   3                                         vScu_Timer1WakeupEn();
 208   3                                 }
 209   2                                 break;
 210   2                        case TIMER_MODE1://一个自动Load的8Bit的Timer
 211   2                             TM1MOD=0x01;
 212   2                                 if(TIMER0==TimerNum)
 213   2                                 {
 214   3                                         TM0CDATA=(UINT8)InitValue;
 215   3                                         //计数器清0
 216   3                                         vTimer0_CounterClr();
 217   3                                         vTimer0_Start();
 218   3                                         vScu_Timer0IntEn();
 219   3      
 220   3                                         vScu_Timer0WakeupEn();
 221   3                                 }
 222   2                                 else if(TIMER1==TimerNum)
 223   2                                 {
 224   3                                         TM1CDATA=(UINT8)InitValue;
 225   3                                         //计数器清0
 226   3                                         //vTimer0_CounterClr();
 227   3                                         vTimer1_CounterClr();
 228   3                                         
 229   3                                         vTimer1_Start();
 230   3                                         vScu_Timer1IntEn();
 231   3              
 232   3                                         vScu_Timer1WakeupEn();
 233   3                                 }                       
 234   2                                 
 235   2                                 break;
 236   2                        case TIMER_MODE2://一个16Bit的Timer
 237   2                             TM1MOD=0x02;     
 238   2      
 239   2                             TM0CDATA=(UINT8)InitValue;
C51 COMPILER V9.01   TIMERFUNC                                                             11/23/2016 11:58:14 PAGE 5   

 240   2                                 TM1CDATA=(UINT8)(InitValue>>8);
 241   2                                 //计数器清0
 242   2                                 vTimer0_CounterClr();
 243   2                                 vTimer1_CounterClr();
 244   2      
 245   2                                 vTimer0_Start();
 246   2                                 //vScu_Timer0IntEn();
 247   2                                 vScu_Timer1IntEn();
 248   2      
 249   2                                 vScu_Timer1WakeupEn();
 250   2                                 break;
 251   2                        default :
 252   2                             break;
 253   2               }
 254   1               EX1=1;  
 255   1               EA=1;   
 256   1      }
 257          
 258          /********************************************************************
 259          Function name:       vTimer2Start
 260          Input parameters:
 261              UINT8 TimerNum：Timer Select 
 262                  UINT8 Mode：Timer Mode Config
 263                  UINT16 InitValue：      Timer Initial 
 264          Return:
 265              void
 266          Function:
 267              Enable Timer Module.
 268          ********************************************************************/
 269          
 270          #if 0
              void vTimer2Start(UINT8 TimerNum,UINT8 Mode,UINT16 InitValue,UINT8 TimerClk)
              {
                   vScu_Timer2ClkEn();
                       vTimerClkSel(TimerNum,TimerClk);
                       switch(Mode)
                       {
                                case TIMER_MODE0:     //两个8Bit的Timer
                                     TM2MOD=0x00;
                                         if(TIMER2==TimerNum)
                                         {                       
                                                 TM2CDATA=(UINT8)InitValue;
                                                 //计数器清0
                                                 vTimer2_CounterClr();
                                                 vTimer2_Start();
                                                 vScu_Timer2IntEn();
              
                                                 vScu_Timer2WakeupEn();
                                         }
                                         else if(TIMER3==TimerNum)
                                         {
                                             
                                                 TM3CDATA=(UINT8)InitValue;
                                                 //计数器清0
                                                 vTimer3_CounterClr();
                                                 vTimer3_Start();
                                                 vScu_Timer3IntEn();
              
                                                 vScu_Timer3WakeupEn();
                                         }
                                         break;
                                case TIMER_MODE1://一个自动Load的8Bit的Timer
C51 COMPILER V9.01   TIMERFUNC                                                             11/23/2016 11:58:14 PAGE 6   

                                     TM2MOD=0x01;                   
                                         if(TIMER2==TimerNum)
                                         {
                                                 TM2CDATA=(UINT8)InitValue;
                                                 //计数器清0
                                                 vTimer2_CounterClr();
                                                 vTimer2_Start();
                                                 vScu_Timer2IntEn();
              
                                                 vScu_Timer2WakeupEn();
                                         }
                                         else if(TIMER3==TimerNum)
                                         {
                                                 TM3CDATA=(UINT8)InitValue;
                                                 //计数器清0
                                                 vTimer3_CounterClr();
                                                 vTimer3_Start();
                                                 vScu_Timer3IntEn();
              
                                                 vScu_Timer3WakeupEn();
                                         }                       
                                         break;
                                case TIMER_MODE2://一个16Bit的Timer
                                     TM2MOD=0x02;                        
              
                                     TM2CDATA=(UINT8)InitValue;
                                         TM3CDATA=(UINT8)(InitValue>>8);
                                         //计数器清0
                                         vTimer2_CounterClr();
                                         vTimer3_CounterClr();
              
                                         vTimer2_Start();
                                         //vScu_Timer0IntEn();
                                         vScu_Timer3IntEn();
              
                                         vScu_Timer3WakeupEn();
                                         break;
                                default :
                                     break;
                       }
                       EX1=1;
                       
                       EA=1;   
              }
              
              #endif
 348          
 349          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    386    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----      14
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
