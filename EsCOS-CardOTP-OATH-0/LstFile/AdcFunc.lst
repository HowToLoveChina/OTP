C51 COMPILER V9.01   ADCFUNC                                                               11/23/2016 11:58:14 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE ADCFUNC
OBJECT MODULE PLACED IN .\ObjFile\AdcFunc.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE SrcFile\Func\AdcFunc.c LARGE BROWSE INCDIR(.\SrcFile\StartUp\CPU;.\SrcFile\
                    -Frame\Inc;.\SrcFile\Func\Inc;.\SrcFile\Lib;.\SrcFile\App\Inc) DEFINE(_DEV_BOARD_,_FPGA_DEMO_EN_) DEBUG OBJECTEXTEND PRIN
                    -T(.\LstFile\AdcFunc.lst) OBJECT(.\ObjFile\AdcFunc.obj)

line level    source

   1          /********************************************************************
   2                                    Nationz Co.,Ltd
   3                  Copyright (c) 2009－2015 All Rights Reserved
   4           ********************************************************************
   5          File: AdcFunc.c
   6          History：
   7          Version                      Author                     Date
   8          V0.1                         nationz              2013-05-10
   9          
  10          Description:
  11               AdcFunc Source Code File;
  12          Function list:
  13              void vAdcInit(UINT8 CH);
  14              UINT16 uiAdc_GetData(void);
  15              void vAdcClose(void);        
  16          Special statement:
  17               NULL
  18           *******************************************************************/
  19          #define _ADCFUNC_C_
  20          #include "ADCFUNC.h"
  21          #include "SCUFUNC.h"
  22          #include "intrins.H"
  23          /********************************************************************
  24          Function name:       void vAdcInit(UINT8 CH)
  25          Input parameters:
  26              UINT8 CH:Sample Chanell Select
  27          Return:
  28              void
  29          Function:
  30              Init Adc Module.
  31          ********************************************************************/
  32          
  33          void vDelay200Us(UINT8 Tcount)
  34          {       
  35   1              do{ 
  36   2                      _nop_();
  37   2                      _nop_();
  38   2                      _nop_();
  39   2                      _nop_();
  40   2                      _nop_();
  41   2                      _nop_();
  42   2              }while(Tcount--);
  43   1      }
  44          void vAdcInit(UINT8 CH)
  45          {
  46   1           //开启模块时钟
  47   1           vScu_AnactrlClkEn();
  48   1               //BG使能
  49   1               vAdcBgEn();
  50   1               //采样通道选择
  51   1               ANALOGCTRLADCCR=0x00;
  52   1               ANALOGCTRLADCCR|=CH;    
  53   1               //ADC使能
C51 COMPILER V9.01   ADCFUNC                                                               11/23/2016 11:58:14 PAGE 2   

  54   1               vAdc_En();
  55   1               //延时5ms
  56   1               vDelay200Us(25);
  57   1      
  58   1               
  59   1               /*vDelay200Us(250);
  60   1               vDelay200Us(250);
  61   1               vDelay200Us(250);
  62   1               vDelay200Us(250);
  63   1               vDelay200Us(250);
  64   1               vDelay200Us(250);*/
  65   1      
  66   1      
  67   1               //vAdc_Start();         
  68   1               //初始化时，先启动一下ADC，让ADC电路保持，后续采样不再需要建立启动时间
  69   1               //vAdc_Dis();
  70   1      }
  71          /********************************************************************
  72          Function name:       UINT16 uiAdc_GetData(void)
  73          Input parameters:
  74              void
  75          Return:
  76              UINT16 ：Adc Sample Value
  77          Function:
  78              Get Adc Sample Value
  79          ********************************************************************/
  80          UINT16 uiAdc_GetData(void)
  81          {
  82   1           vAdc_Start();
  83   1      
  84   1               //若采用2MHz时钟需延时
  85   1               vDelay200Us(250);
  86   1               vDelay200Us(250);
  87   1               vDelay200Us(250);
  88   1               vDelay200Us(250);
  89   1               vDelay200Us(250);
  90   1               vDelay200Us(250);
  91   1      
  92   1               while(!(ANALOGCTRLSR1&ADC_DONE))
  93   1               ANALOGCTRLSR1|=ADC_DONE;
  94   1               vAdc_Stop();
  95   1               return ADC_VALUE;
  96   1      }
  97          /********************************************************************
  98          Function name:       void vAdcClose(void)
  99          Input parameters:
 100              void
 101          Return:
 102              void
 103          Function:
 104              Close Adc Module
 105          ********************************************************************/
 106          void vAdcClose(void)
 107          {
 108   1               
 109   1               vAdc_Stop();
 110   1               //ADC使能关闭
 111   1               vAdc_Dis();
 112   1               vAdcBgDis();
 113   1               //vScu_AnactrlClkDis(); //不能关模拟模块时钟，LCD显示需要
 114   1      }

C51 COMPILER V9.01   ADCFUNC                                                               11/23/2016 11:58:14 PAGE 3   


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    117    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
